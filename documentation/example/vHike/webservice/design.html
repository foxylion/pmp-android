<!DOCTYPE html>
<html>
<head>
  <title>Webservice Entwurf - Privacy Management Platform</title>
  <script type="text/javascript" src="../../../_layout/jquery-1.6.2.min.js"></script>
  <script type="text/javascript" src="../../../_layout/script.js"></script>
  <script type="text/javascript" src="../../../_layout/fancybox/jquery.fancybox-1.3.4.pack.js"></script>
  
  <link type="text/css" rel="stylesheet" media="screen" href="../../../_layout/fancybox/jquery.fancybox-1.3.4.css">
  <link type="text/css" rel="stylesheet" media="screen" href="../../../_layout/style.css">
  <link type="text/css" rel="stylesheet" media="print"  href="../../../_layout/print.css">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
  <div id="wrapper">
    <div id="page-head-date">28. November 2011</div>
    <div id="page-head-title">Privacy Management Platform</div>
    <div id="page-title">Entwurf - Webservice vHike</div>
    <div id="page-version">Version 0.1</div>
    
    <nav>
      <div class="title">Inhaltsverzeichnis</div>
      <ul>
      </ul>
    </nav>
    
    <!-- here comes the content of the specification -->
    <div id="content">
      

      
      <h1 id="interface">Schnittstelle</h1>
      <p>
        Dieser Abschnitt beschreibt die für den Zugriff auf den Webservice bereitsgestellte
        Schnittstellen.
      </p>
      <p>
        Hierzu werde nachfolgend alle verfügbaren PHP-Skripte aufgelistet, die von
        diesen erwartete Parameter genannt und die durch das Skript generierte Ausgabe erläutert.
      </p>
        Die Übergabe von Parametern, die keinen Einfluss auf den Zustand des Servers
        haben (also keine auf den Server gespeicherten Daten manipulieren) 
        ergolgt über HTTP-GET (d.h. die Parameter werden der URL angehängt).
        Für alle anderen Parameter sowie Parameter, über die eine große Menge an Daten
        übertragen werden, erfolgt die Datenübertragung durch HTTP-Post.
      </p>
      <p>
        Die Rückgabe des PHP-Skripts - also die Antwort auf Anfragen - erfolgt
        in JSON. Hierbei gibt es JSON-Schlüssel, die von jedem Skript zurückgegeben
        werden sowie Schlüssel, die Skript spezifisch sind.
      </p>
        
      <h2 id="interface_defaultjsonkey">Standard JSON Schlüssel</h2>
      <p>
        Die JSON Rückgabe jedes Skipts enthält in der obersten Ebene den 
        Schlüssel <code>successful</code>. Dieser gibt an, ob die Anfrage erfolgreich
        bearbeitet werden konnte (<code>successful</code> ist auf <code>true</code>
        gesetzt), oder ob bei der Bearbeitung Fehler aufgetreten sind 
        (<code>successful</code> auf <code>false</code>. z.B. wenn der Benutzer
        nicht angemeldet sit, die Abfrage jedoch einen angemeldeten Benutzer verlangt).
      </p>
      
      <h2 id="interface_error">Fehlerrückgabe</h2>
      <p>
        Wie bereits erwähnt, wird über den Schlüssel <code>successful</code> signalisiert, 
        ob die Anfrage verarbeitet werden konnte. Ist dieser auf <code>false</code>
        gestzt, wurde die Anfrage nicht erfolreich ausgeführt. In diesem Fall
        hat die JSON Rückgabe jedes Skripts immer folgenden Aufbau:
      </p>
<pre>
{
  "successful": false,
  "error": String,
  "msg": String;
}                                 
</pre>
      <p>
        Der Wert des Schlüssels <code>error</code> definiert die Ursache des Fehlers.
        Momentan sind folgende Werte vorgesehen:
        <ul>
          <li><code>NOT_LOGGED_IN</code> - der Benutzer ist nicht angemeldet, die
            Ausführung der Anfrage erfordert dies jedoch</li>
          <li><code>INVALID_DATABASE-QUERY</code> - interner Fehler. Die für die Bearbeitung
            der Anfrage durchgeführte Datanbankabfrage ist fehlerhaft</li>
          <li><code>CANNOT_CONNECT_TO_DATABASE</code> - interner Fehler. Die Verbindung
            zur Datenbank bzw. zum Datenbank-Server konnte nicht hergestellt werden.</li>
        </ul>
        Diese Fehler-Codes dienen hauptsächlich zur einfachen Fallunterscheidung
        innerhalb der auf den Webservice zugreifenden Applikation.
        So kann z.B. bei <code>NOT_LOGGED_IN</code>-Fehler zuerst das Login-Script
        aufgerufen werden, und anschließend die Anfrage, die zuvor diesen Fehler
        erzeugte erneut aufgerufen werden.
      </p>
      <p>
        In vielen Fällen genügt der Fehler-Code jedoch nicht, um den Fehler genau beschreiben 
        zu können.  So ist es etwa bei einem <code>DB-TABLE_NOT_FOUND</code>-Fehler
        hilfreich zu wissen, auf welche Tabelle nicht zugegriffen werden kann.
        Daher exisitert der Schlüssel <code>msg</code> über den weitere Informationen
        über den Fehler ausgegeben werden können.
      </p>
      
      <h2 id="interface_query">Anfragen</h2>
      <p>
        Nachfolgend werden alle Anfragen aufgelistet, die gegenwärtig vom 
        Webservice unterstützt werden. Für alle diese Anfragen wird nur der Fall
        behandelt, in dem die Anfrage erfolgreich bearbeitet werden konnte
        (<code>successful</code> auf <code>true</code>). Für das Verhalten im Fehlerfall
        siehe obiger Abschnitt.
      </p>
      <p>
        <b>Hinweis:</b> Mit "Zugriffsrecht" wird angegeben, welche Benutzer 
        diese Anfrage ausführen können. Ist diese Bedinung nicht erfüllt, wird
        Fehler zurückgegeben (siehe vorhergehender Abschnitt).
      </p>
      
      <h3 id="interface_query_types">Wertetypen</h3>
      <p>
        Gegenwärtig werden folgende Wertetypen für die Parameter verwendet:
        <ul>
          <li>Boolean: Wird als Zeichenkette <code>true</code> oder <code>false</code>
            übergeben. Zeichenketten, die nicht <code>true</code> entsprechen, darunter
            auch leere Zeichenketten, werden (sofern nichts anderes vermerkt), als
            <code>false</code> interpretiert</li>
          <li>Integer</li>
          <li>Float</li>
          <li>String: Eine Zeichenkette mit i. A. begrenzter Länge</li>
          <li>Data</li>
        </ul>
      </p>

      <h3 id="interface_query_register">Registrieren</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>register.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Registriert einen neuen Benutzer im System. Nach erfolgreicher Registrierung
            wird dem Benutzer an seine angegebene E-Mail-Adresse ein Link zu geschickt.
            Durch öffnen dieses Links wird das Benutzerkonto aktiviert. Danach
            kann sich der Benutzer im System anmelden.</td>
        </tr>     
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Jeder</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>-</td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>
            <ul>
              <li><code>username</code> - String: Der gewünschte Benutzername des neuen Kontos</li>
              <li><code>password</code> - String: Das gewünschte Passwort als Reintext (nicht gehasht)</li>
              <li><code>email</code> - String: Die E-Mail-Adresse des Benutzer</li>
              <li><code>firstname</code> - String: Vorname des Benutzers</li>
              <li><code>lastname</code> - String: Nachname des Benutzers</li>
              <li><code>tel</code> - String: Telefonnummer des Benutzers</li>
              <li><code>description</code> - String: Eine kurze Beschreibung, die
                der Benutzer seinem Konto hinzufügen kann</li>
              <li><code>email_public</code> - Boolean: True, wenn die E-Mail-Adresse
                des Benutzers für andere Mitglieder sichtbar sein soll</li>
              <li><code>firstname_public</code> - Boolean: True, wenn der Vorname
                des Benutzers für andere Mitglieder sichtbar sein soll</li>
              <li><code>lastname_public</code> - Boolean: True, wenn der Nachname
                des Benutzers für andere Mitglieder sichtbar sein soll</li>
              <li><code>tel_public</code> - Boolean: True, wenn die Telefonnummer
                des Benutzers für andere Mitglieder sichtbar sein soll</li>
            </ul>
          </td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true,
  "status": String
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
            <ul>
              <li><code>status</code> - Gibt an, ob das Konto angelegt werden konnte.
                Wurde das Konto angelegt, ist <code>status</code> auf <code>registered</code>
                gesetzt. War die Registrierung nicht möglich, ist das Feld auf
                <code>{(username_exists|email_exists|<br />invalid_(username|password|firstname|lastname|tel)),}</code>gesetzt.
                Ein Fehlschlag tritt u.A. auf, wenn ein Pflichtfeld (alle außer
                <code>description</code>) nicht angegeben wurde, es in ungültiges 
                Format hat (z.B. die angegebene E-Mail kein "@" enthält) oder zu lang
                ist (i.A. max. 100 Zeichen je Feld)</li>
              </ul>
          </td>
        </tr>
      </table>
      
      
      <h3 id="interface_query_login">Anmelden</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>login.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Meldet einen bereits registrierten Benutzer im System an</td>
        </tr>     
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Jeder</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>
              <li><code>username</code> - String: Name des anzumeldenden Benutzers</li>
              <li><code>password</code> - String: Passwort des anzumeldenden Benutzers</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>-</td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true,
  "status": String,
  "sid": HEX-String
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
            <ul>
              <li><code>status</code> - gibt an, ob der Benutzer angemeldet wurde.
                Konnte die Anmeldung durchgeführt werden, so ist <code>status</code>
                auf <code>logged_in</code> gesetzt. Waren Benutzername oder Passwort
                ungültig, ist das Feld auf <code>invalid</code> gesetzt. Sind die 
                Daten korrekt, der Benutzer hat sein Konto aber noch nicht aktiviert,
                wird der Wert auf <code>inactivated</code> gesetzt</li>
              <li><code>sid</code> - Session-ID, unter der die Daten des soeben
                angemeldeten Benutzer auf dem Server zwischengespeichert wurden.
                Genau dieser HEX-String muss allen Nachfolgenden Skripten im
                GET-Parameter <code>sid</code> übergeben werden</li>
              </ul>
          </td>
        </tr>
      </table>
      
          
      <h3 id="interface_query_logout">Abmelden</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>logout.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Meldet einen angemeldeten Benutzer vom System ab</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Jeder</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>
              <li><code>sid</code> - HEX-String: Sessen-ID des Benutzers, der abgemeldet werden soll</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>-</td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>-</td>
        </tr>
      </table>
      
      
      <h3 id="interface_get_profile">Profil-Daten abrufen</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>get_profile.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Der angemeldete Benutzer möchte Informationen über das Profil eines
            anderen Benutzers abrufen.</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Angemeldete Benutzer</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>           
              <li><code>id</code> - Integer: Die ID des Benutzers, dessen Profildaten abgerufen werden sollen</li>
              <li><code>sid</code> - HEX-String: Sessen-ID des Benutzers, der die Profildaten abrufen möchte</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>-</td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true
  "id": Integer,
  "username": String
  "regdate": Date
  "rating": Integer
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
           <ul>           
              <li><code>id</code> - Integer: Die ID des Benutzers</li>
              <li><code>username</code> - String: Der Name des Benutzers</li>
              <li><code>regdat</code> - Date: Datum, an dem sich der Benutzer registriert hat</li>
              <li><code>rating</code> - Integer: Durchschnittsbewertung des Benutzers</li>
            </ul>
          </td>
        </tr>
      </table>
      
      
      <h3 id="interface_announce_trip">Fahrt bekannt geben</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>announce_trip.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Der angemeldete Benutzer startet eine Fahrt, auf der er Mitfahrer
            mitnehmen möchte.</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Angemeldete Benutzer</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>
              <li><code>sid</code> - HEX-String: Sessen-ID des Benutzers, der die Fahrt bekannt gibt</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>
            <ul>
              <li><code>destination</code> - String: Name des Zielortes</li>
            </ul>
          </td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>-</td>
        </tr>
      </table>
      
      
    </div>
    <!-- // end of specification's content -->
  </div>
</body>
</html>