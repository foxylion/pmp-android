<!DOCTYPE html>
<html>
<head>
  <title>Webservice Entwurf - Privacy Management Platform</title>
  <script type="text/javascript" src="../../../_layout/jquery-1.6.2.min.js"></script>
  <script type="text/javascript" src="../../../_layout/script.js"></script>
  <script type="text/javascript" src="../../../_layout/fancybox/jquery.fancybox-1.3.4.pack.js"></script>
  
  <link type="text/css" rel="stylesheet" media="screen" href="../../../_layout/fancybox/jquery.fancybox-1.3.4.css">
  <link type="text/css" rel="stylesheet" media="screen" href="../../../_layout/style.css">
  <link type="text/css" rel="stylesheet" media="print"  href="../../../_layout/print.css">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
  <div id="wrapper">
    <div id="page-head-date">03. Dezember 2011</div>
    <div id="page-head-title">Privacy Management Platform</div>
    <div id="page-title">Entwurf - Webservice vHike</div>
    <div id="page-version">Version 0.2</div>
    
    <nav>
      <div class="title">Inhaltsverzeichnis</div>
      <ul>
      </ul>
    </nav>
    
    <!-- here comes the content of the specification -->
    <div id="content">
    
      <h1 id="introduction">Einleitung</h1>
      <p>
        Dieses Dokument stellt den Aufbau des Webservices und dessen
        Schnittstellen dar. Es richtet sich daher auch an die Entwickler der
        Applikationen, die die zur Verfügung gestellten Schnittstellen verwenden
        möchten.
      </p>
      

      <h1 id="databse">Datenbank</h1>          
      <p>                                      
        Nachfolgendes ER-Diagramm beschreibt den Aufbau der Datenbank und die 
        Relationen zwischen den Tabellen.
      </p>
      <p>
        Entgegen dem dargestellten Aufbau wurde die <code>rating</code>-Tabelle
        nicht übernommen. Um trotzdem feststellen zu können, ob eine Bewertung 
        bereits durchgeführt, wurde der Tabelle <code>ride</code> die Spalten
        (vom Typ <code>BOOLEAN</code>) <code>driver_rated</code> und <code>passenger_rated</code>
        hinzugefügt. Ist dieser Wert auf "1" gesetzt, wurde die Bewertung des
        Fahrers bzw. des Mitfahrers bereits durchgeführt.
      </p>
      <p>
        Zur Speicherung der Bewertung wurde der <code>user</code>-Tabelle
        die Spalten <code>rating_avg</code> und <code>rating_num</code> hinzugefügt.
        Diese speichern die Durchschnittsbewertung bzw. die Anzahl der abgegebenen
        Bewertungen.
      </p>
      <p>    
        <img src="./db-layout.png" style="width:100%;" />
      </p>
      
      <h1 id="interface">Schnittstelle</h1>
      <p>
        Dieser Abschnitt beschreibt die für den Zugriff auf den Webservice bereitsgestellte
        Schnittstellen.
      </p>
      <p>
        Hierzu werde nachfolgend alle verfügbaren PHP-Skripte aufgelistet, die von
        diesen erwartete Parameter genannt und die durch das Skript generierte Ausgabe erläutert.
      </p>
        Die Übergabe von Parametern, die keinen Einfluss auf den Zustand des Servers
        haben (also keine auf den Server gespeicherten Daten manipulieren) 
        ergolgt über HTTP-GET (d.h. die Parameter werden der URL angehängt).
        Für alle anderen Parameter sowie Parameter, über die eine große Menge an Daten
        übertragen werden, erfolgt die Datenübertragung durch HTTP-Post.
      </p>
      <p>
        Die Rückgabe des PHP-Skripts - also die Antwort auf Anfragen - erfolgt
        in JSON. Hierbei gibt es JSON-Schlüssel, die von jedem Skript zurückgegeben
        werden sowie Schlüssel, die Skript spezifisch sind.
      </p>
        
      <h2 id="interface_defaultjsonkey">Standard JSON Schlüssel</h2>
      <p>
        Die JSON Rückgabe jedes Skipts enthält in der obersten Ebene den 
        Schlüssel <code>successful</code>. Dieser gibt an, ob die Anfrage erfolgreich
        bearbeitet werden konnte (<code>successful</code> ist auf <code>true</code>
        gesetzt), oder ob bei der Bearbeitung Fehler aufgetreten sind 
        (<code>successful</code> auf <code>false</code>. z.B. wenn der Benutzer
        nicht angemeldet sit, die Abfrage jedoch einen angemeldeten Benutzer verlangt).
      </p>
      
      <h2 id="interface_error">Fehlerrückgabe</h2>
      <p>
        Wie bereits erwähnt, wird über den Schlüssel <code>successful</code> signalisiert, 
        ob die Anfrage verarbeitet werden konnte. Ist dieser auf <code>false</code>
        gestzt, wurde die Anfrage nicht erfolreich ausgeführt. In diesem Fall
        hat die JSON Rückgabe jedes Skripts immer folgenden Aufbau:
      </p>
<pre>
{
  "successful": false,
  "error": String,
  "msg": String;
}                                 
</pre>
      <p>
        Der Wert des Schlüssels <code>error</code> definiert die Ursache des Fehlers.
        Momentan sind folgende Werte vorgesehen:
        <ul>
          <li><code>not_logged_in</code> - der Benutzer ist nicht angemeldet, die
            Ausführung der Anfrage erfordert dies jedoch</li>
          <li><code>invalid_database-query</code> - interner Fehler. Die für die Bearbeitung
            der Anfrage durchgeführte Datanbankabfrage ist fehlerhaft</li>
          <li><code>cannot_connect_to_database</code> - interner Fehler. Die Verbindung
            zur Datenbank bzw. zum Datenbank-Server konnte nicht hergestellt werden.</li>   
          <li><code>invalid_parameter</code> - wenn ein POST-/GET-Parameter einen 
            ungültigen Wert enthält (z.B. Integer verlangt, Wert jedoch kein Integer)</li>
        </ul>
        Diese Fehler-Codes dienen hauptsächlich zur einfachen Fallunterscheidung
        innerhalb der auf den Webservice zugreifenden Applikation.
        So kann z.B. bei <code>NOT_LOGGED_IN</code>-Fehler zuerst das Login-Script
        aufgerufen werden, und anschließend die Anfrage, die zuvor diesen Fehler
        erzeugte erneut aufgerufen werden.
      </p>
      <p>
        In vielen Fällen genügt der Fehler-Code jedoch nicht, um den Fehler genau beschreiben 
        zu können.  So ist es etwa bei einem <code>DB-TABLE_NOT_FOUND</code>-Fehler
        hilfreich zu wissen, auf welche Tabelle nicht zugegriffen werden kann.
        Daher exisitert der Schlüssel <code>msg</code> über den weitere Informationen
        über den Fehler ausgegeben werden können.
      </p>
      
      <h2 id="interface_query">Anfragen</h2>
      <p>
        Nachfolgend werden alle Anfragen aufgelistet, die gegenwärtig vom 
        Webservice unterstützt werden. Für alle diese Anfragen wird nur der Fall
        behandelt, in dem die Anfrage erfolgreich bearbeitet werden konnte
        (<code>successful</code> auf <code>true</code>). Für das Verhalten im Fehlerfall
        siehe obiger Abschnitt.
      </p>
      <p>
        <b>Hinweis:</b> Mit "Zugriffsrecht" wird angegeben, welche Benutzer 
        diese Anfrage ausführen können. Ist diese Bedinung nicht erfüllt, wird
        Fehler zurückgegeben (siehe vorhergehender Abschnitt).
      </p>
      
      <h3 id="interface_query_types">Wertetypen</h3>
      <p>
        Gegenwärtig werden folgende Wertetypen für die Parameter verwendet:
        <ul>
          <li>Boolean: Wird als Zeichenkette <code>true</code> oder <code>false</code>
            übergeben. Zeichenketten, die nicht <code>true</code> entsprechen, darunter
            auch leere Zeichenketten, werden (sofern nichts anderes vermerkt), als
            <code>false</code> interpretiert</li>
          <li>Integer</li>
          <li>Float</li>
          <li>String: Eine Zeichenkette mit i. A. begrenzter Länge</li>
          <li>Data</li>
        </ul>
      </p>

      <h3 id="interface_query_register">Registrieren</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>register.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Registriert einen neuen Benutzer im System. Nach erfolgreicher Registrierung
            wird dem Benutzer an seine angegebene E-Mail-Adresse ein Link zu geschickt.
            Durch öffnen dieses Links wird das Benutzerkonto aktiviert. Danach
            kann sich der Benutzer im System anmelden.</td>
        </tr>     
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Jeder</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>-</td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>
            <ul>
              <li><code>username</code> - String (3 &le; Zeichen &le; 100): Der gewünschte Benutzername des neuen Kontos</li>
              <li><code>password</code> - String (3 &le; Zeichen &le; 100): Das gewünschte Passwort als Reintext (nicht gehasht)</li>
              <li><code>email</code> - String (3 &le; Zeichen &le; 100): Die E-Mail-Adresse des Benutzer</li>
              <li><code>firstname</code> - String (3 &le; Zeichen &le; 100): Vorname des Benutzers</li>
              <li><code>lastname</code> - String (3 &le; Zeichen &le; 100): Nachname des Benutzers</li>
              <li><code>tel</code> - String (3 &le; Zeichen &le; 100): Telefonnummer des Benutzers</li>
              <li><code>description</code> - String: Eine kurze Beschreibung, die
                der Benutzer seinem Konto hinzufügen kann</li>
              <li><code>email_public</code> - Boolean: True, wenn die E-Mail-Adresse
                des Benutzers für andere Mitglieder sichtbar sein soll</li>
              <li><code>firstname_public</code> - Boolean: True, wenn der Vorname
                des Benutzers für andere Mitglieder sichtbar sein soll</li>
              <li><code>lastname_public</code> - Boolean: True, wenn der Nachname
                des Benutzers für andere Mitglieder sichtbar sein soll</li>
              <li><code>tel_public</code> - Boolean: True, wenn die Telefonnummer
                des Benutzers für andere Mitglieder sichtbar sein soll</li>
            </ul>
          </td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true,
  "status": String
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
            <ul>
              <li><code>status</code> - Gibt an, ob das Konto angelegt werden konnte.
                Wurde das Konto angelegt, ist <code>status</code> auf <code>registered</code>
                gesetzt. War die Registrierung nicht möglich, ist das Feld auf
                <code>{(username_exists|email_exists|<br />invalid_(username|password|firstname|lastname|tel)),}</code>gesetzt.
                Ein Fehlschlag tritt u.A. auf, wenn ein Pflichtfeld (alle außer
                <code>description</code>) nicht angegeben wurde, es in ungültiges 
                Format hat (z.B. die angegebene E-Mail kein "@" enthält) oder zu lang
                ist (i.A. max. 100 Zeichen je Feld)</li>
              </ul>
          </td>
        </tr>           
        <tr>  
          <th class="left">Status</th>
          <td>Implementiert, jedoch ungetestet</td>
        </tr>
      </table>
      
      
      <h3 id="interface_query_login">Anmelden</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>login.php</td>
        </tr>                        
        <tr>
          <th class="left">Beschreibung</th>
          <td>Meldet einen bereits registrierten Benutzer im System an</td>
        </tr>     
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Jeder</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>-</td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>
            <ul>
              <li><code>username</code> - String: Name des anzumeldenden Benutzers</li>
              <li><code>password</code> - String: Passwort des anzumeldenden Benutzers</li>
            </ul>
          </td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true,
  "status": String,
  "sid": String
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
            <ul>
              <li><code>status</code> - gibt an, ob der Benutzer angemeldet wurde.
                Konnte die Anmeldung durchgeführt werden, so ist <code>status</code>
                auf <code>logged_in</code> gesetzt. Waren Benutzername oder Passwort
                ungültig, ist das Feld auf <code>invalid</code> gesetzt. Sind die 
                Daten korrekt, der Benutzer hat sein Konto aber noch nicht aktiviert,
                wird der Wert auf <code>inactivated</code> gesetzt</li>
              <li><code>sid</code> - Session-ID, unter der die Daten des soeben
                angemeldeten Benutzer auf dem Server zwischengespeichert wurden.
                Genau dieser String muss allen Nachfolgenden Skripten im
                GET-Parameter <code>sid</code> übergeben werden</li>
              </ul>
          </td>
        </tr>          
        <tr>  
          <th class="left">Status</th>
          <td>Implementiert, jedoch ungetestet</td>
        </tr>
      </table>
      
          
      <h3 id="interface_query_logout">Abmelden</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>logout.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Meldet einen angemeldeten Benutzer vom System ab</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Jeder</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>
              <li><code>sid</code> - String: Session-ID des Benutzers, der abgemeldet werden soll</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>-</td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>-</td>
        </tr>           
        <tr>  
          <th class="left">Status</th>
          <td>Implementiert, jedoch ungetestet</td>
        </tr>
      </table>
      
      
      <h3 id="interface_own_profile">Eigene Profil-Daten abrufen</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>own_profile.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Der angemeldete Benutzer möchte Informationen über sein Profil 
            abrufen.</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Angemeldete Benutzer</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>           
              <li><code>sid</code> - String: Session-ID des Benutzers, der die Profildaten abrufen möchte</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>-</td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful":true,
  "id": Integer,
  "username": String,
  "email": String,
  "firstname": String,
  "lastname": String,
  "tel": String,
  "description": String,
  "regdate": Date,
  "email_public": Boolean,
  "firstname_public": Boolean,
  "lastname_public": Boolean,
  "tel_public": Boolean,
  "rating_avg": Float,
  "rating_num": Integer
}                               
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
           <ul>           
              <li><code>id</code> - Integer: Die ID des Benutzers</li>
              <li><code>username</code> - String: Der Name des Benutzers</li>  
              <li><code>email</code> - String: Die E-Mail-Adresse des Benutzers</li>
              <li><code>firstname</code> - String: Der Vorname des Benutzers</li>
              <li><code>lastname</code> - String: Der Nachname des Benutzers</li> 
              <li><code>tel</code> - String: Die Telefon-Nr. des Benutzers</li> 
              <li><code>description</code> - String: Die Beschreibung, die der Benutzer über sich hinterlegt hat</li>
              <li><code>regdat</code> - Date: Datum, an dem sich der Benutzer registriert hat</li>  
              <li><code>email_public</code> - Boolean: True, wenn die E-Mail-Adresse für andere sichtbar sein soll</li>
              <li><code>firstname_public</code> - Boolean: True, wenn der Vorname für andere sichtbar sein soll</li>    
              <li><code>lastname_public</code> - Boolean: True, wenn der Nachname für andere sichtbar sein soll</li>  
              <li><code>tel_public</code> - Boolean: True, wenn die Telefon-Nr. für andere sichtbar sein soll</li>
              <li><code>rating_avg</code> - Float: Durchschnittsbewertung des Benutzers</li>        
              <li><code>rating_num</code> - Integer: Anzahl der für den Benutzer abgegebenen Bewertungen</li>
            </ul>
          </td>
        </tr>             
        <tr>  
          <th class="left">Status</th>
          <td>Implementiert, jedoch ungetestet</td>
        </tr>
      </table>
      
      
      <h3 id="interface_get_profile">Profil-Daten abrufen</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>get_profile.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Der angemeldete Benutzer möchte Informationen über das Profil eines
            anderen Benutzers abrufen.</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Angemeldete Benutzer</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>           
              <li><code>id</code> - Integer: Die ID des Benutzers, dessen Profildaten abgerufen werden sollen</li>
              <li><code>sid</code> - String: Session-ID des Benutzers, der die Profildaten abrufen möchte</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>-</td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful":true,
  "status": String,
  "id": Integer,
  "username": String,
  "email": String,
  "firstname": String,
  "lastname": String,
  "tel": String,
  "description": String,
  "regdate": Date,
  "email_public": Boolean,
  "firstname_public": Boolean,
  "lastname_public": Boolean,
  "tel_public": Boolean,
  "rating_avg": Float,
  "rating_num": Integer
}                               
                            
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
           <ul>           
              <li><code>status</code> - String: <code>found</code> wenn zur 
                angegebenen ID ein Benutzer gefunden wurde, sonst <code>not_found</code>.
                Nachfolgende Felder werden nur beim Status <code>found</code> ausgegeben</li>
              <li><code>id</code> - Integer: Die ID des Benutzers</li>
              <li><code>username</code> - String: Der Name des Benutzers</li>  
              <li><code>email</code> - String: Die E-Mail-Adresse des Benutzers, 
                sofern diese für andere Mitglieder öffentlich ist (<code>"email_public": true</code>)
                andernfalls wird dieser Schlüssel nicht ausgegeben</li>
              <li><code>firstname</code> - String: Der Vorname des Benutzers, 
                sofern diese für andere Mitglieder öffentlich ist (<code>"firstname_public": true</code>)
                andernfalls wird dieser Schlüssel nicht ausgegeben</li>
              <li><code>lastname</code> - String: Der Nachname des Benutzers, 
                sofern diese für andere Mitglieder öffentlich ist (<code>"lastname_public": true</code>)
                andernfalls wird dieser Schlüssel nicht ausgegeben</li> 
              <li><code>tel</code> - String: Die Telefon-Nr. des Benutzers, 
                sofern diese für andere Mitglieder öffentlich ist (<code>"tel_public": true</code>)
                andernfalls wird dieser Schlüssel nicht ausgegeben</li> 
              <li><code>description</code> - String: Die Beschreibung, die der Benutzer über sich hinterlegt hat</li>
              <li><code>regdat</code> - Date: Datum, an dem sich der Benutzer registriert hat</li>  
              <li><code>email_public</code> - Boolean: True, wenn die E-Mail-Adresse für andere sichtbar sein soll</li>
              <li><code>firstname_public</code> - Boolean: True, wenn der Vorname für andere sichtbar sein soll</li>    
              <li><code>lastname_public</code> - Boolean: True, wenn der Nachname für andere sichtbar sein soll</li>  
              <li><code>tel_public</code> - Boolean: True, wenn die Telefon-Nr. für andere sichtbar sein soll</li>
              <li><code>rating_avg</code> - Float: Durchschnittsbewertung des Benutzers</li>        
              <li><code>rating_num</code> - Integer: Anzahl der für den Benutzer abgegebenen Bewertungen</li>
            </ul>
          </td>
        </tr>              
        <tr>  
          <th class="left">Status</th>
          <td>Implementiert, jedoch ungetestet</td>
        </tr>
      </table>
      
      
      <h3 id="interface_announce_trip">Fahrt bekannt geben</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>trip_announce.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Der angemeldete Benutzer startet eine Fahrt, auf der er Mitfahrer
            mitnehmen möchte.</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Angemeldete Benutzer</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>
              <li><code>sid</code> - String: Session-ID des Benutzers, der die Fahrt bekannt gibt</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>
            <ul>
              <li><code>destination</code> - String (3 &le; Zeichen &le; 100): Name des Zielortes</li>  
              <li><code>current_lat</code> - Float (6 Stellen, 4 Nachkommastellen): Breitengrad, an dem sich der Benutzer momentan befindet</li>
              <li><code>current_lon</code> - Float (7 Stellen, 4 Nachkommastellen): Längengrad, an dem sich der Benutzer momentan befindet</li>      
              <li><code>avail_seats</code> - Integer (1 &le; x &le; 99): Anzahl der Sitze, die der Fahrer in seinem Fahrzeug noch für Mitfahrer frei hat</li>
            </ul>
          </td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true,
  "status": String,
  "id": Integer
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
           <ul>           
              <li><code>status</code> - String: <code>announced</code> wenn die Fahrt angelegt wurde oder
                <code>open_trip_exists</code> wenn der Fahrer noch eine nicht beendete Fahrt offen hat
              <li><code>id</code> - Integer: Die ID der soeben angelegten Fahrt (nur wenn <code>"status": "announced"</code>)</li>
            </ul>
          </td>
        </tr>              
        <tr>  
          <th class="left">Status</th>
          <td>Implementiert, jedoch ungetestet</td>
        </tr>
      </table>
      
      
      <h3 id="interface_trip_update_pos">Fahrer-Position aktualisieren</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>trip_update_pos.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Die Position des Fahrers soll geändert werden, damit potentielle
            Mitfahrer ihn sehen können</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Angemeldete Benutzer</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>
              <li><code>sid</code> - String: Session-ID des Benutzers, der die Fahrt bekannt gibt</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>
            <ul>
              <li><code>id</code> - Integer: ID der Fahrt, zu denen die Position aktualisiert werden soll</li>  
              <li><code>current_lat</code> - Float (6 Stellen, 4 Nachkommastellen): Breitengrad, an dem sich der Benutzer momentan befindet</li>
              <li><code>current_lon</code> - Float (7 Stellen, 4 Nachkommastellen): Längengrad, an dem sich der Benutzer momentan befindet</li> 
            </ul>
          </td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true,
  "status": String
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
           <ul>           
              <li><code>status</code> - String: Gibt an, ob der Datensatz aktualisiert werden konnte.
                <code>updated</code>, wenn der Datensatz erfolgreich aktualisiert wurde,
                <code>already_uptodate</code>, wenn der Datensatz bereits auf die gegebenen Werte aktualisiert wurde,
                <code>no_trip</code>, wenn die Fahrt-ID auf eine nicht vorhandene Fahrt verweist,
                <code>has_ended</code>, wenn die Fahrt bereits beendet wurde oder
                <code>invalid_user</code>, wenn die Fahrt nicht dem momentan angemeldeten Benutzer zugeordnet ist</li>
            </ul>
          </td>
        </tr>            
        <tr>  
          <th class="left">Status</th>
          <td>Implementiert, jedoch ungetestet</td>
        </tr>
      </table>
      
      
      <h3 id="interface_trip_update_data">Fahrt Daten ändern</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>trip_update_data.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Der Fahrer möchte das Ziel seiner Fahrt oder die Anzahl der verfügbaren Sitze 
            ändern.<br />
            <b>Hinweis:</b> Die Anzeige der noch verfübaren Sitze wird aus der
            Angabe <code>avail_seats</code> und den momentan angenommenen Mitfahr-Anfragen
            dynamisch berechnet. Daher darf das Feld <code>avail_seats</code> bei
            Mitnahme eines Fahrtsuchenden NICHT aktualisiert werden. Dies würde zu
            einer falschen Anzeige der noch verfügbaren Sitze führen.</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Angemeldete Benutzer</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>
              <li><code>sid</code> - String: Session-ID des Benutzers, der die Fahrt bekannt gibt</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>
            <ul>                              
              <li><code>id</code> - Integer: ID der Fahrt, zu denen die Daten aktualisiert werden sollen</li>  
              <li><code>avail_seats</code> - Integer (1 &le; x &le; 99): Anzahl der Sitze, die der Fahrer in seinem Fahrzeug noch für Mitfahrer frei hat</li>
            </ul>
          </td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true,
  "status": String
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
           <ul>           
              <li><code>status</code> - String: Gibt an, ob der Datensatz aktualisiert werden konnte.
                <code>updated</code>, wenn der Datensatz erfolgreich aktualisiert wurde,                   
                <code>already_uptodate</code>, wenn der Datensatz bereits auf die gegebenen Werte aktualisiert wurde,
                <code>no_trip</code>, wenn die Fahrt-ID auf eine nicht vorhandene Fahrt verweist,
                <code>has_ended</code>, wenn die Fahrt bereits beendet wurde oder
                <code>invalid_user</code>, wenn die Fahrt nicht dem momentan angemeldeten Benutzer zugeordnet ist</li>
            </ul>
          </td>
        </tr>            
        <tr>  
          <th class="left">Status</th>
          <td>Implementiert, jedoch ungetestet</td>
        </tr>
      </table>
      
      
      <h3 id="interface_trip_ended">Fahrt beenden</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>trip_ended.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Der Fahrer hat seine Fahrt beendet.</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Angemeldete Benutzer</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>
              <li><code>sid</code> - String: Session-ID des Benutzers, der die Fahrt bekannt gibt</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>
            <ul>      
              <li><code>id</code> - Integer: ID der Fahrt, die beendet werden soll</li>  
            </ul>
          </td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true,
  "status": String
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
           <ul>           
              <li><code>status</code> - String: Gibt an, ob der Datensatz aktualisiert werden konnte.
                <code>updated</code>, wenn der Datensatz erfolgreich aktualisiert wurde,                   
                <code>already_uptodate</code>, wenn der Datensatz bereits auf die gegebenen Werte aktualisiert wurde,
                <code>no_trip</code>, wenn die Fahrt-ID auf eine nicht vorhandene Fahrt verweist,
                <code>has_ended</code>, wenn die Fahrt bereits beendet wurde oder
                <code>invalid_user</code>, wenn die Fahrt nicht dem momentan angemeldeten Benutzer zugeordnet ist</li>
            </ul>
          </td>
        </tr>            
        <tr>  
          <th class="left">Status</th>
          <td>Implementiert, jedoch ungetestet</td>
        </tr>
      </table>
      
      
      <h3 id="interface_query_start">Anfrage starten</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>query_start.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Ein Mitfahrer sucht einen Fahrer</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Angemeldete Benutzer</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>
              <li><code>sid</code> - String: Session-ID des Benutzers, der die Fahrt bekannt gibt</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>
            <ul>
              <li><code>destination</code> - String (3 &le; Zeichen &le; 100): Name des Zielortes</li>  
              <li><code>current_lat</code> - Float (6 Stellen, 4 Nachkommastellen): Breitengrad, an dem sich der Benutzer momentan befindet</li>
              <li><code>current_lon</code> - Float (7 Stellen, 4 Nachkommastellen): Längengrad, an dem sich der Benutzer momentan befindet</li>      
              <li><code>seats</code> - Integer (1 &le; x &le; 99): Anzahl der Sitze, die der Mitfahrer benötigt</li>
            </ul>
          </td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true,
  "id": Integer
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
           <ul>           
              <li><code>id</code> - Integer: ID der soeben angelegten Anfrage</li>
            </ul>
          </td>
        </tr>
      </table>
      
      
      <h3 id="interface_query_delete">Anfrage löschen</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>query_delete.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Ein Mitfahrer möchte eine angelegte Anfrage löschen</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Angemeldete Benutzer</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>
              <li><code>sid</code> - String: Session-ID des Benutzers, der die Fahrt bekannt gibt</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>
            <ul>
              <li><code>id</code> - Integer: ID der Anfrage, die gelöscht werden soll</li>  
            </ul>
          </td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true,
  "status": String
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
           <ul>           
              <li><code>status</code> - String: Gibt an, ob die Anfrage geöscht wurde.
                <code>deleted</code>, wenn die Anfrage gelöscht wurde,
                <code>no_query</code>, wenn die Anfrage-ID auf eine nicht vorhandene Anfrage verweist oder
                <code>invalid_user</code>, wenn die Anfrage nicht dem momentan angemeldeten Benutzer zugeordnet ist</li>
            </ul>
          </td>
        </tr>
      </table>
      
      
      
      <h3 id="interface_search_queries">Anfragen suchen</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>query_search.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Ein Fahrer möchte Anfragen in einem bestimmten Umkreis suchen</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Angemeldete Benutzer</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>                                                                                             
              <li><code>sid</code> - String: Session-ID des Benutzers, der die Fahrt bekannt gibt</li>     
              <li><code>trip_id</code> - Integer: ID der Fahrt, zu der der Fahrer Anfragen suchen möchte (wird zum Vergleichen des Ziels benötigt)</li>   
              <li><code>lat</code> - Float (6 Stellen, 4 Nachkommastellen): Breitengrad und...</li>   
              <li><code>lon</code> - Float (7 Stellen, 4 Nachkommastellen): ...Längengrad an denen nach Anfragen gesucht werden soll</li>  
              <li><code>perimeter</code> - Integer (1 &le; x &le; 10.000): Umkreis in Meter, in dem gesucht werden soll</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>-</td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true,
  "queries": [
    {"userid": Integer, "username": String, "rating": Float, 
      "lat": Float, "lon": Float, "seats", Integer},   
    {"userid": Integer, "username": String, "rating": Float, 
      "lat": Float, "lon": Float, "seats", Integer},
    ...
  ]
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
           <ul>           
              <li><code>queries</code> - Array: Array mit allen gefundenen Anfragen:
                <ul>
                  <li><code>userid</code> - Integer: ID des anfragenden Benutzers</li>  
                  <li><code>username</code> - String: Name des anfragenden Benutzers</li>   
                  <li><code>rating</code> - Float: Durchschnittsbewertung des Benutzers</li> 
                  <li><code>lat</code> - Float (6 Stellen, 4 Nachkommastellen): Breitengrad an dem sich der Benutzer befindet</li>    
                  <li><code>lon</code> - Float (7 Stellen, 4 Nachkommastellen): Längengrad an dem sich der Benutzer befindet</li>  
                  <li><code>seats</code> - Integer: Sitze, die der Anfragende benötigt</li>
                </ul>
            </ul>
          </td>
        </tr>
      </table>
      
      
      <h3 id="interface_offer">Mitfahrer einladen</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>offer.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Ein Fahrer möchte einen Mitfahrer auf eine Fahrt einladen</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Angemeldete Benutzer</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>
              <li><code>sid</code> - String: Session-ID des Benutzers</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>
            <ul>
              <li><code>query</code> - Integer: ID der Anfrage, für die der Fahrer eine Einladung erstellen möchte</li>  
              <li><code>message</code> - String: Eine Nachricht, die der Fahrer dem Suchenden hinerlassen möchte</li>  
            </ul>
          </td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true,
  "status": String
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
           <ul>           
              <li><code>status</code> - String: Gibt an, ob die Einladung erstellt wurde.
                <code>sent</code>, wenn die Einladung abgesendet wurde oder
                <code>invalid_query</code>, wenn die Anfrage-ID auf eine nicht vorhandene Anfrage verweist</li>
            </ul>
          </td>
        </tr>
      </table>
      
      
      <h3 id="interface_offer_view">Einladungen/Angebote anzeigen</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>offer_view.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Ein Anfragender möchte die erhaltenen Einladungen/Angebote angezeigt bekommen</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Angemeldete Benutzer</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>
              <li><code>sid</code> - String: Session-ID des Benutzers</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>-</td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true,
  "offers": [
    {"offer": Integer, "userid": Integer, "username": String, 
      "rating": Float},   
    {"offer": Integer, "userid": Integer, "username": String, 
      "rating": Float},
    ...
  ]
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td><ul>           
              <li><code>offers</code> - Array: Array mit allen gefundenen Angeboten:
                <ul>                                                                    
                  <li><code>offer</code> - Integer: ID der Anfrage</li>  
                  <li><code>userid</code> - Integer: ID des anbietenden Benutzers</li>  
                  <li><code>username</code> - String: Name des anbietenden Benutzers</li>   
                  <li><code>rating</code> - Float: Durchschnittsbewertung des Benutzers</li> 
                </ul>
            </ul>
          </td>
        </tr>
      </table>
      
      
      
      <h3 id="interface_offer">Einladung/Angebot annhemen oder ablehnen</h3>
      <table>
        <tr>
          <th class="left">PHP-Skript</th>
          <td>offer_handle.php</td>
        </tr> 
        <tr>
          <th class="left">Beschreibung</th>
          <td>Ein Mitfahrer hat ein Angebot erhalten und möchte dieses annehmen oder ablehnen</td>
        </tr>   
        <tr>
          <th class="left">Zugriffsrecht</th>
          <td>Angemeldete Benutzer</td>
        </tr>
        <tr>
          <th class="left">GET-Parameter</th>
          <td>
            <ul>
              <li><code>sid</code> - String: Session-ID des Benutzers</li>
            </ul>
          </td>
        </tr>     
        <tr>
          <th class="left">POST-Parameter</th>
          <td>
            <ul>
              <li><code>offer</code> - Integer: ID des Angebots, die der Benutzer annhemen bzw. ablehnen möchte</li>  
              <li><code>accept</code> - Boolean: True, um das Angebot anzunehmen, False um es abzulehnen</li>  
            </ul>
          </td>
        </tr>      
        <tr>
          <th class="left">Rückgabe (Aufbau)</th>
          <td>
<pre>
{
  "successful": true,
  "status": String
}                                 
</pre>  
          </td>
        </tr>
        <tr>   
          <th class="left">Rückgabe (Beschreibung)</th>
          <td>
           <ul>           
              <li><code>status</code> - String: Gibt an, ob die Angebot angenommen oder abgeleht wurde.
                <code>handled</code>, wenn das Angebot behandelt wurde,
                <code>invalid_offer</code>, wenn die Angebots-ID auf ein nicht vorhandenes Angebot verweist oder</li>           
                <code>invalid_user</code>, wenn die Angebots-ID auf ein Angebot verweist, dass nicht dem angemelden Benutzer gilt</li>
            </ul>
          </td>
        </tr>
      </table>
      
    </div>
    <!-- // end of specification's content -->
  </div>
</body>
</html>